using Godot;
using System;

public partial class Player : CharacterBody3D
{
    [Export]
    public float InteractionRange = 3f;

    [Export]
    public Node3D CameraNode; // Assign your Camera3D in the editor

    public override void _PhysicsProcess(double delta)
    {
        if (Input.IsActionJustPressed("interact")) // Make sure "interact" is mapped (e.g., to "E")
        {
            TryInteract();
        }
    }

    private void TryInteract()
    {
        var spaceState = GetWorld3D().DirectSpaceState;
        var from = CameraNode.GlobalTransform.Origin;
        var to = from + CameraNode.GlobalTransform.Basis.Z * -InteractionRange;

        var query = PhysicsRayQueryParameters3D.Create(from, to);
        query.CollideWithAreas = false;

        var result = spaceState.IntersectRay(query);
        if (result.Count > 0 && result["collider"] is Node hitNode)
        {
            if (hitNode is IInteractable interactable)
            {
                interactable.Interact();
            }
            else
            {
                GD.Print("Hit something, but it's not interactable.");
            }
        }
    }
}
